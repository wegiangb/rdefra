<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>rdefra: Interact with the UK AIR Pollution Database from DEFRA • rdefra</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="rdefra: Interact with the UK AIR Pollution Database from DEFRA">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rdefra</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://www.doi.org/10.21105/joss.00051">JOSS paper</a>
    </li>
    <li>
      <a href="../articles/index.html">Vignette</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/rdefra">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>rdefra: Interact with the UK AIR Pollution Database from DEFRA</h1>
                        <h4 class="author">Claudia Vitolo</h4>
            
            <h4 class="date">2018-08-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rdefra/blob/master/vignettes/rdefra_vignette.Rmd"><code>vignettes/rdefra_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>rdefra_vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The package rdefra allows to retrieve air pollution data from the Air Information Resource (UK-AIR, <a href="https://uk-air.defra.gov.uk/" class="uri">https://uk-air.defra.gov.uk/</a>) of the Department for Environment, Food and Rural Affairs in the United Kingdom. UK-AIR does not provide a public API for programmatic access to data, therefore this package scrapes the HTML pages to get relevant information.</p>
<p>This package follows a logic similar to other packages such as waterData and rnrfa: sites are first identified through a catalogue, data are imported via the station identification number, then data are visualised and/or used in analyses. The metadata related to the monitoring stations are accessible through the function <code><a href="../reference/ukair_catalogue.html">ukair_catalogue()</a></code>, missing stations’ coordinates can be obtained using the function <code><a href="../reference/ukair_get_coordinates.html">ukair_get_coordinates()</a></code>, and time series data related to different pollutants can be obtained using the function <code><a href="../reference/ukair_get_hourly_data.html">ukair_get_hourly_data()</a></code>.</p>
<p>The package is designed to collect data efficiently. It allows to download multiple years of data for a single station with one line of code and, if used with the parallel package, allows the acquisition of data from hundreds of sites in only few minutes.</p>
<div id="dependencies-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#dependencies-installation" class="anchor"></a>Dependencies &amp; Installation</h2>
<div id="dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#dependencies" class="anchor"></a>Dependencies</h3>
<p>The rdefra package depends on two things:</p>
<ul>
<li><p>The Geospatial Data Abstraction Library (gdal).</p></li>
<li><p>Some additional CRAN packages. Check for missing dependencies and install them using the commands below:</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">packs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"httr"</span>, <span class="st">"xml2"</span>, <span class="st">"lubridate"</span>, <span class="st">"tibble"</span>, <span class="st">"dplyr"</span>, <span class="st">"sp"</span>, <span class="st">"devtools"</span>,</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">           <span class="st">"leaflet"</span>, <span class="st">"zoo"</span>, <span class="st">"testthat"</span>, <span class="st">"knitr"</span>, <span class="st">"Rmarkdown"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">new.packages &lt;-<span class="st"> </span>packs[<span class="op">!</span>(packs <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">"Package"</span>])]</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="cf">if</span>(<span class="kw">length</span>(new.packages)) <span class="kw">install.packages</span>(new.packages)</a></code></pre></div>
</div>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<p>Get the released version from CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"rdefra"</span>)</a></code></pre></div>
<p>Or the development version from github using <a href="https://github.com/hadley/devtools">devtools</a>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"ropensci/rdefra"</span>)</a></code></pre></div>
<p>Load the rdefra package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rdefra"</span>)</a></code></pre></div>
</div>
</div>
<div id="functions" class="section level2">
<h2 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h2>
<p>The package logic assumes that users access the UK-AIR database in two steps:</p>
<ol style="list-style-type: decimal">
<li>Browse the catalogue of available stations and selects some stations of interest.</li>
<li>Retrieves data for the selected stations.</li>
</ol>
<div id="get-metadata-catalogue" class="section level3">
<h3 class="hasAnchor">
<a href="#get-metadata-catalogue" class="anchor"></a>Get metadata catalogue</h3>
<p>DEFRA monitoring stations can be downloaded and filtered using the function <code><a href="../reference/ukair_catalogue.html">ukair_catalogue()</a></code> with no input parameters, as in the example below.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Get full catalogue</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">stations_raw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ukair_catalogue.html">ukair_catalogue</a></span>()</a></code></pre></div>
<p>The same function, can be used to filter the catalogue using the following input parameters:</p>
<ul>
<li>
<code>site_name</code> IDs of specific site (UK.AIR.ID). By default this is left blank to get info on all the available sites.</li>
<li>
<code>pollutant</code> This is an integer between 1 and 10. Default is 9999, which means all the pollutants.</li>
<li>
<code>group_id</code> This is the identification number of a group of stations. Default is 9999 which means all available networks.</li>
<li>
<code>closed</code> This is set to TRUE to include closed stations, FALSE otherwise.</li>
<li>
<code>country_id</code> This is the identification number of the country, it can be an integer between 1 and 6. Default is 9999, which means all the countries.</li>
<li>
<code>region_id</code> This is the identification number of the region. 1 = Aberdeen City, etc. (for the full list see <a href="https://uk-air.defra.gov.uk/" class="uri">https://uk-air.defra.gov.uk/</a>). Default is 9999, which means all the local authorities.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">stations_EnglandOzone &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ukair_catalogue.html">ukair_catalogue</a></span>(<span class="dt">pollutant =</span> <span class="dv">1</span>, <span class="dt">country_id =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>The example above shows how to retrieve the 107 stations in England in which ozone is measured.</p>
</div>
<div id="get-missing-coordinates" class="section level3">
<h3 class="hasAnchor">
<a href="#get-missing-coordinates" class="anchor"></a>Get missing coordinates</h3>
<p>Locating a station is extremely important to be able to carry out any spatial analysis. If coordinates are missing, for some stations in the catalogue, it might be possible to retrieve Easting and Northing (coordinates in the British National Grid) from DEFRA’s web pages. Get E and N, transform them to latitude and longitude and populate the missing coordinates using the code below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Scrape DEFRA website to get Easting/Northing</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">stations &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ukair_get_coordinates.html">ukair_get_coordinates</a></span>(stations_raw)</a></code></pre></div>
</div>
<div id="check-hourly-data-availability" class="section level3">
<h3 class="hasAnchor">
<a href="#check-hourly-data-availability" class="anchor"></a>Check hourly data availability</h3>
<p>Pollution data started to be collected in 1972 and consists of hourly concentration of various species (in μg/m<sup>3</sup>), such as ozone (O<sub>3</sub>), particulate matters (PM<sub>2.5</sub> and PM<sub>10</sub>), nitrogen dioxide (NO<sub>2</sub>), sulphur dioxide (SO<sub>2</sub>), and so on.</p>
<p>The ID under which they are available differs from the UK.AIR.ID. The catalogue does not contain this additional station ID (called SiteID hereafter) but DEFRA’s web pages contain references to both the UK.AIR.ID and the SiteID. The function below uses as input the UK.AIR.ID and outputs the SiteID, if available.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">stations<span class="op">$</span>SiteID &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ukair_get_site_id.html">ukair_get_site_id</a></span>(stations<span class="op">$</span>UK.AIR.ID)</a></code></pre></div>
</div>
<div id="get-hourly-data" class="section level3">
<h3 class="hasAnchor">
<a href="#get-hourly-data" class="anchor"></a>Get hourly data</h3>
<p>The time series for a given station can be retrieved in one line of code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Get 1 year of hourly ozone data from London Marylebone Road monitoring station</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ukair_get_hourly_data.html">ukair_get_hourly_data</a></span>(<span class="st">"MY1"</span>, <span class="dt">years=</span><span class="dv">2015</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"># Aggregate to daily means and plot</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">library</span>(<span class="st">"zoo"</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">my1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/zoo/topics/zoo">zoo</a></span>(<span class="dt">x =</span> df<span class="op">$</span>Ozone, <span class="dt">order.by =</span> <span class="kw">as.POSIXlt</span>(df<span class="op">$</span>datetime))</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mai =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)) </a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">plot</span>(<span class="kw">aggregate</span>(my1, <span class="kw"><a href="http://www.rdocumentation.org/packages/zoo/topics/yearmon">as.Date</a></span>(<span class="kw">as.POSIXlt</span>(df<span class="op">$</span>datetime)), mean), </a>
<a class="sourceLine" id="cb10-4" data-line-number="4">     <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">"Ozone concentration ["</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                                                    mu, <span class="st">"g/"</span>, m<span class="op">^</span><span class="dv">3</span>, <span class="st">"]"</span>)))</a></code></pre></div>
<div class="figure">
<img src="hourlydata-1.png" alt="Hourly ozone data from London Marylebone Road monitoring station"><p class="caption">Hourly ozone data from London Marylebone Road monitoring station</p>
</div>
<p>Highest concentrations seem to happen in late spring and at the beginning of summer. In order to check whether this happens every year, we can download multiple years of data and then compare them.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Get 15 years of hourly ozone data from the same monitoring station</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">library</span>(<span class="st">"dplyr"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">library</span>(<span class="st">"lubridate"</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ukair_get_hourly_data.html">ukair_get_hourly_data</a></span>(<span class="st">"MY1"</span>, <span class="dt">years =</span> <span class="dv">2000</span><span class="op">:</span><span class="dv">2015</span>)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">df &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(df, </a>
<a class="sourceLine" id="cb11-8" data-line-number="8">             <span class="dt">year =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(datetime),</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">             <span class="dt">month =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span>(datetime),</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">             <span class="dt">year_month =</span> <span class="kw">strftime</span>(datetime, <span class="st">"%Y-%m"</span>))</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(month, year_month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">ozone =</span> <span class="kw">mean</span>(Ozone, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_boxplot">geom_boxplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(month), <span class="dt">y =</span> ozone, <span class="dt">group =</span> month),</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">               <span class="dt">outlier.shape =</span> <span class="ot">NA</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Month of the year"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">"Ozone concentration ("</span>, mu, <span class="st">"g/"</span>,m<span class="op">^</span><span class="dv">3</span>,<span class="st">")"</span>)))</a></code></pre></div>
<div class="figure">
<img src="ozone-1.png" alt="15 years of hourly ozone data from London Marylebone Road monitoring station"><p class="caption">15 years of hourly ozone data from London Marylebone Road monitoring station</p>
</div>
<p>The above box plots show that the highest concentrations usually occurr during April/May and that these vary year-by-year.</p>
</div>
</div>
<div id="cached-catalogue" class="section level2">
<h2 class="hasAnchor">
<a href="#cached-catalogue" class="anchor"></a>Cached catalogue</h2>
<p>For convenience, a cached version of the catalogue (last updated in August 2016) is included in the package and can be loaded using the following command:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">data</span>(<span class="st">"stations"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">stations</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; # A tibble: 6,569 x 17</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;    UK.AIR.ID EU.Site.ID EMEP.Site.ID Site.Name Environment.Type Zone </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt;  1 UKA15910  &lt;NA&gt;       &lt;NA&gt;         " SH15, … &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;  2 UKA15956  &lt;NA&gt;       &lt;NA&gt;         " SH15, … &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;  3 UKA16663  &lt;NA&gt;       &lt;NA&gt;         " SH15, … &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt;  4 UKA16097  &lt;NA&gt;       &lt;NA&gt;         10 High … &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;  5 UKA12536  &lt;NA&gt;       &lt;NA&gt;         ABBOTS L… &lt;NA&gt;             Grea…</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;  6 UKA12949  &lt;NA&gt;       &lt;NA&gt;         ABERBARG… &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  7 UKA12399  &lt;NA&gt;       &lt;NA&gt;         ABERCARN… &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  8 UKA13340  &lt;NA&gt;       &lt;NA&gt;         ABERDARE… &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;  9 UKA13341  &lt;NA&gt;       &lt;NA&gt;         ABERDARE… &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; 10 UKA15369  &lt;NA&gt;       &lt;NA&gt;         ABERDARE… &lt;NA&gt;             Sout…</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; # ... with 6,559 more rows, and 11 more variables: Start.Date &lt;dttm&gt;,</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; #   End.Date &lt;dttm&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;, Altitude..m. &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; #   Networks &lt;chr&gt;, AURN.Pollutants.Measured &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; #   Site.Description &lt;chr&gt;, Easting &lt;dbl&gt;, Northing &lt;dbl&gt;, SiteID &lt;chr&gt;</span></a></code></pre></div>
<p>The cached catalogue contains all the available site IDs and coordinates and can be quickly used as lookup table to find out the correspondence between the UK.AIR.ID and SiteID, as well as to investigate station characteristics.</p>
</div>
<div id="applications" class="section level2">
<h2 class="hasAnchor">
<a href="#applications" class="anchor"></a>Applications</h2>
<div id="plotting-stations-locations" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-stations-locations" class="anchor"></a>Plotting stations’ locations</h3>
<p>In the raw catalogue, 3837 stations contain valid coordinates. After scraping DEFRA’s web pages, the number of stations with valid coordinates rises to 6567. In the figure below, blue circles show all the stations with valid coordinates, while red circles show stations with available hourly data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">stations_with_Hdata &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="op">!</span><span class="kw">is.na</span>(stations<span class="op">$</span>SiteID))</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">library</span>(<span class="st">"leaflet"</span>)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/leaflet">leaflet</a></span>(<span class="dt">data =</span> stations) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addTiles</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addCircleMarkers</a></span>(<span class="dt">lng =</span> <span class="op">~</span>Longitude[stations_with_Hdata], </a>
<a class="sourceLine" id="cb13-6" data-line-number="6">                   <span class="dt">lat =</span> <span class="op">~</span>Latitude[stations_with_Hdata], </a>
<a class="sourceLine" id="cb13-7" data-line-number="7">                   <span class="dt">radius =</span> <span class="fl">0.5</span>, <span class="dt">color=</span><span class="st">"red"</span>, </a>
<a class="sourceLine" id="cb13-8" data-line-number="8">                   <span class="dt">popup =</span> <span class="op">~</span>SiteID[stations_with_Hdata]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addCircleMarkers</a></span>(<span class="dt">lng =</span> <span class="op">~</span>Longitude, </a>
<a class="sourceLine" id="cb13-10" data-line-number="10">                   <span class="dt">lat =</span> <span class="op">~</span>Latitude,  </a>
<a class="sourceLine" id="cb13-11" data-line-number="11">                   <span class="dt">popup =</span> <span class="op">~</span>SiteID,</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">                   <span class="dt">radius =</span> <span class="dv">1</span>, <span class="dt">color=</span><span class="st">"blue"</span>, <span class="dt">fill =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="figure">
<img src="map-1.png" alt="Blue circles show stations with valid coordinates, while red circles show stations with available hourly data"><p class="caption">Blue circles show stations with valid coordinates, while red circles show stations with available hourly data</p>
</div>
</div>
<div id="analyse-the-spatial-distribution-of-the-monitoring-stations" class="section level3">
<h3 class="hasAnchor">
<a href="#analyse-the-spatial-distribution-of-the-monitoring-stations" class="anchor"></a>Analyse the spatial distribution of the monitoring stations</h3>
<p>Below are two plots showing the spatial distribution of the monitoring stations. These are concentrated largely in urban areas and mostly estimate the background level of concentration of pollutants.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># Zone</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">dotchart</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(stations<span class="op">$</span>Zone))[,<span class="dv">1</span>])</a></code></pre></div>
<div class="figure">
<img src="dotchart1-1.png" alt="Dotchart1"><p class="caption">Dotchart1</p>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Environment.Type</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">dotchart</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(stations<span class="op">$</span>Environment.Type[stations<span class="op">$</span>Environment.Type <span class="op">!=</span><span class="st"> "Unknown Unknown"</span>]))[,<span class="dv">1</span>])</a></code></pre></div>
<div class="figure">
<img src="dotchart2-1.png" alt="Dotchart2"><p class="caption">Dotchart2</p>
</div>
</div>
<div id="use-multiple-cores-to-speed-up-data-retrieval-from-numerous-sites" class="section level3">
<h3 class="hasAnchor">
<a href="#use-multiple-cores-to-speed-up-data-retrieval-from-numerous-sites" class="anchor"></a>Use multiple cores to speed up data retrieval from numerous sites</h3>
<p>The acquisition of data from hundreds of sites takes only few minutes:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"parallel"</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co"># Use detectCores() to find out many cores are available on your machine</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">cl &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/makeCluster">makeCluster</a></span>(<span class="kw">getOption</span>(<span class="st">"cl.cores"</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/detectCores">detectCores</a></span>()))</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="kw">system.time</span>(myList &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/clusterApply">parLapply</a></span>(cl, stations<span class="op">$</span>SiteID[stations_with_Hdata], </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">                                ukair_get_hourly_data, <span class="dt">years=</span><span class="dv">1999</span><span class="op">:</span><span class="dv">2016</span>))</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/makeCluster">stopCluster</a></span>(cl)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10"></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">df &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(myList)</a></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#dependencies-installation">Dependencies &amp; Installation</a></li>
      <li><a href="#functions">Functions</a></li>
      <li><a href="#cached-catalogue">Cached catalogue</a></li>
      <li><a href="#applications">Applications</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Claudia Vitolo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
